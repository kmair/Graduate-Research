      SUBROUTINE A6L2S4(X,Y,NXY,MD,W,K,T,NT,B,H,BX,NTMK)
C
C
      INTEGER IXL,IT,IX,I1,IDX1,J,I2
      INTEGER MD,NXY,NT,K,NTMK
            REAL X(NXY),Y(NXY,MD),W(NXY,MD),T(NT),H(NTMK,K),B(NTMK),BX(K
     *,MD)
C
C
C
C
C
      CALL SETR(K*NTMK,0.0E0,H)
      CALL SETR(NTMK,0.0E0,B)
C
      IXL = 1
C
      IT = 1
 1002 CONTINUE
      IF( IT.GE.NT )      GOTO 1001
C     DO THE POINTS INTERVAL BY INTERVAL.
      IF( T(IT).NE.T(IT+1) )      GOTO 1003
      GOTO 1000
 1003 CONTINUE
C
      IX = IXL
 1007 CONTINUE
      IF( IX.GT.NXY )      GOTO 1006
      IF( X(IX).LE.T(IT+1) )      GOTO 1008
      IXL = IX
      GOTO 1006
 1008 CONTINUE
      IF( X(IX).NE.T(IT+1).OR.X(IX).GE.T(NT) )      GOTO 1010
      IXL = IX
      GOTO 1006
 1010 CONTINUE
      IXL = IX+1
      IX1002 = MAX0(IX-1,1)
      IF( X(IX).NE.X(IX1002).OR.IX.LE.1 )      GOTO 1012
      GOTO 1005
C
 1012 CONTINUE
      CALL BSPLD(K,T,NT,X(IX),1,IT,MD,BX)
C
      DO 1014 J = 1, MD
      I1 = MAX0(IT+1-K,1)
 1019 CONTINUE
      IF( I1.GT.MIN0(IT,NT-K) )      GOTO 1018
      IDX1 = I1-IT+K
      B(I1) = B(I1)+BX(IDX1,J)*Y(IX,J)*W(IX,J)
C
      I2 = MAX0(K,IT)+1-I1
 1022 CONTINUE
      IF( I2.GT.K )      GOTO 1021
      IX1001 = I1-IT+I2
      H(I1,I2) = H(I1,I2)+BX(IDX1,J)*BX(IX1001,J)*W(IX,J)
 1020 CONTINUE
      I2 = I2+1
      GOTO 1022
 1021 CONTINUE
 1017 CONTINUE
      I1 = I1+1
      GOTO 1019
 1018 CONTINUE
 1014 CONTINUE
 1015 CONTINUE
 1005 CONTINUE
      IX = IX + (1)
      GOTO 1007
 1006 CONTINUE
C
 1000 CONTINUE
      IT = IT + (1)
      GOTO 1002
 1001 CONTINUE
      RETURN
C
      END
