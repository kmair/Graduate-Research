      REAL FUNCTION GAMMA(X)
      REAL X
      INTEGER IWRITE, NTOTAL, N, MOD, NDEGR, I1MACH
      REAL PI, ALOG, XBIG, XMED, FACTOR, XX
      REAL YY, GAMINV, A(18), BIG
      REAL TCHBP, SMALL, CONST
      REAL P0, P1, P2, P3, P4, P5, P6, R1MACH
C J. L. BLUE, 23 DEC 77
C FOR X .LE. (-XMED), USE GAMMA(X)*GAMMA(1-X)=PI/SIN(PI*X)
C FOR (-XMED).LE.X.LE.1 AND 2.LE.X.LE.XMED, USE X*GAMMA(X)=GAMMA(X+1)
C FOR 1.LE.X.LE.2, USE CHEBYSHEV EXPANSION
C FOR XMED.LE.X, USE ASYMPTOTIC FORMULA
C CALCULATE INVERSE OF GAMMA, THEN SEE IF IT IS INVERTIBLE,
C TO AVOID OVERFLOW.
      DATA A( 1)/+1.06377 30078 05261 97553 E0/
      DATA A( 2)/-0.00498 55872 86840 03595 E0/
      DATA A( 3)/-0.06419 25436 10915 82288 E0/
      DATA A( 4)/+0.00506 57986 40286 08725 E0/
      DATA A( 5)/+0.00041 66091 38709 68886 E0/
      DATA A( 6)/-0.00008 04814 12497 84711 E0/
      DATA A( 7)/+0.00000 29600 11775 18802 E0/
      DATA A( 8)/+0.00000 02689 75996 44060 E0/
      DATA A( 9)/-0.00000 00333 96463 06868 E0/
      DATA A(10)/+0.00000 00010 89653 86454 E0/
      DATA A(11)/+0.00000 00000 51385 01863 E0/
      DATA A(12)/-0.00000 00000 06600 74100 E0/
      DATA A(13)/+0.00000 00000 00247 69163 E0/
      DATA A(14)/+0.00000 00000 00002 20039 E0/
      DATA A(15)/-0.00000 00000 00000 67072 E0/
      DATA A(16)/+0.00000 00000 00000 03132 E0/
      DATA A(17)/-0.00000 00000 00000 00039 E0/
      DATA A(18)/-0.00000 00000 00000 00003 E0/
      DATA NTOTAL/18/
      DATA P0/+0.83333 33333 33333 33315 54247 E-1/
      DATA P1/-0.27777 77777 77768 16225 53 E-2/
      DATA P2/+0.79365 07935 00350 248 E-3/
      DATA P3/-0.59523 79913 04301 2 E-3/
      DATA P4/+0.84171 38778 1295 E-3/
      DATA P5/-0.19104 44077 728 E-2/
      DATA P6/+0.57083 83526 1 E-2/
      DATA PI   /+3.14159 26535 89793 23846E0/
      DATA NDEGR,XBIG,XMED,CONST,SMALL,BIG/0,0.E0,0.E0,0.E0,0.E0,0.E0/
C FIRST-TIME SWITCH
      IF (NDEGR .GT. 0) GOTO 7
         IF (I1MACH(12)+I1MACH(13) .LE. 0) GOTO 1
            SMALL = R1MACH(1)
            GOTO  2
   1        SMALL = (2.0*R1MACH(4)+1.0)/R1MACH(2)
   2     BIG = (1.0-2.0*R1MACH(4))*R1MACH(2)
         XMED = 12.0E0
         XBIG = SQRT(R1MACH(2))
         CONST = ALOG(SQRT(2.*PI))
         YY = 0.
         NDEGR = NTOTAL+1
   3     IF (YY .GE. R1MACH(3) .OR. NDEGR .LT. 4) GOTO  4
            NDEGR = NDEGR-1
            YY = YY+ABS(A(NDEGR))
            GOTO  3
   4     NDEGR = NDEGR-1
         IF (R1MACH(4) .GE. 1.E-20) GOTO 6
            IWRITE = I1MACH(2)
            WRITE(IWRITE,  5)
   5        FORMAT(48H GAMMA IS NOT FULL PRECISION, BUT ONLY 20 DIGITS)
   6     CONTINUE
   7  XX = X
      IF (ABS(XX) .GE. XMED) GOTO 11
         FACTOR = 1.
   8     IF (XX .GE. 1.) GOTO  9
            FACTOR = FACTOR*XX
            XX = XX+1.
            GOTO  8
   9     IF (XX .LE. 2.) GOTO  10
            XX = XX-1.
            FACTOR = FACTOR*XX
            GOTO  9
  10     GAMINV = TCHBP(NDEGR, A, XX, 1.0, 2.0)
         IF (X .LT. 1.) GAMINV = GAMINV*FACTOR
         IF (X .GT. 2.) GAMINV = GAMINV/FACTOR
         GOTO  14
  11     IF (X .LT. 0.) XX = 1.-X
C ASYMPTOTIC REGION
         IF (XX .LE. XBIG) GOTO 12
            GAMINV = 0.
            GOTO  13
  12        YY = 1./XX**2
            GAMINV = EXP((0.5-XX)*ALOG(XX)+XX-CONST-(P0+YY*(P1+YY*(P2+
     1         YY*(P3+YY*(P4+YY*(P5+YY*P6))))))/XX)
  13     CONTINUE
  14  IF (X .LE. (-XMED)) GOTO 17
         IF (ABS(GAMINV) .GE. SMALL) GOTO 15
C/6S
C           CALL SETERR(17H GAMMA - OVERFLOW, 17, 1, 1)
C/7S
            CALL SETERR(' GAMMA - OVERFLOW', 17, 1, 1)
C/
            GOTO  16
  15        GAMMA = 1.0/GAMINV
  16     CONTINUE
         GOTO  20
C RANGE REDUCTION FOR SIN
  17     N = 0.5-X
         XX = X+FLOAT(N)
         IF (MOD(N, 2) .EQ. 1) XX = -XX
         YY = SIN(PI*XX)/PI
         IF (GAMINV .GT. ABS(YY)*BIG) GOTO 18
            GAMMA = GAMINV/YY
            GOTO  19
C/6S
C 18        CALL SETERR(17H GAMMA - OVERFLOW, 17, 1, 1)
C/7S
  18        CALL SETERR(' GAMMA - OVERFLOW', 17, 1, 1)
C/
  19     CONTINUE
  20  RETURN
      END
